<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stop Wasting Tokens: CCAD boosts unique generation by +18 points (54%→72%)</title>
  <meta name="description" content="CCAD (Cumulative Context Anti‑Duplication) improves token efficiency for LLM‑driven science (+15–18% UPT) via canonicalization, cumulative anti‑dup context, exact and fuzzy dedup (ECFP4/Tanimoto), adaptive policy, and deterministic RAG. 3‑command quickstart included." />
  <meta property="og:title" content="Stop Wasting Tokens: CCAD boosts unique generation by +18 points (54%→72%)" />
  <meta property="og:description" content="How CCAD reduces duplicate generation and increases UPT using canonicalization, anti‑dup context, exact+fuzzy dedup, and deterministic RAG. With a 3‑command quickstart." />
  <meta property="og:type" content="article" />
  <meta name="color-scheme" content="light dark" />
  <style>
    :root {
      --bg: #ffffff; --fg: #111827; --muted: #6b7280; --accent: #2563eb;
      --code-bg: #0b1020; --code-fg: #e5e7eb; --card: #f8fafc; --border: #e5e7eb;
    }
    @media (prefers-color-scheme: dark) {
      :root { --bg:#0b0f1a; --fg:#e5e7eb; --muted:#9ca3af; --card:#0f1627; --border:#1f2937; --accent:#60a5fa; --code-bg:#0a0f1e; --code-fg:#e5e7eb; }
    }
    html, body { margin: 0; padding: 0; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    body {
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
      background: var(--bg);
      color: var(--fg);
      line-height: 1.7;
      font-size: 18px;
    }
    .container { max-width: 860px; margin: 0 auto; padding: 2rem 1.25rem 4rem; }
    h1 { font-size: 2.3rem; line-height: 1.2; margin: 0 0 0.75rem; letter-spacing: -0.02em; }
    h2 { font-size: 1.6rem; margin: 2rem 0 0.75rem; }
    h3 { font-size: 1.25rem; margin: 1.25rem 0 0.5rem; }
    p { margin: 0.9rem 0; word-wrap: break-word; }
    .lead { color: var(--muted); font-size: 1.05rem; }
    .meta { color: var(--muted); font-size: 0.95rem; margin-bottom: 1.25rem; }
    .hero { background: var(--card); padding: 1rem; border-radius: 12px; border: 1px solid var(--border); }
    .tags { display:flex; flex-wrap: wrap; gap: .5rem; }
    .tag { display: inline-block; padding: 0.25rem 0.6rem; border-radius: 999px; background: #e0e7ff; color: #1e40af; font-size: 0.85rem; }
    @media (prefers-color-scheme: dark) { .tag{ background:#1e293b; color:#93c5fd; } }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Ubuntu Mono", Consolas, "Liberation Mono", "Courier New", monospace; }
    pre {
      background: var(--code-bg);
      color: var(--code-fg);
      padding: 1rem;
      border-radius: 8px;
      overflow: auto;
      font-size: 0.9rem; border: 1px solid #11182733;
    }
    .grid { display: grid; grid-template-columns: 1fr; gap: 1.25rem; }
    @media (min-width: 900px) { .grid-2 { grid-template-columns: 1fr 1fr; } }
    figure { margin: 1rem 0; }
    figure img { width: 100%; height: auto; border-radius: 8px; border: 1px solid var(--border); background: #fff; }
    figure figcaption { font-size: 0.9rem; color: var(--muted); margin-top: 0.5rem; }
    .callout {
      border-left: 4px solid var(--accent);
      padding: 0.75rem 1rem;
      background: #f0f7ff;
      border-radius: 6px;
      margin: 1rem 0;
    }
    @media (prefers-color-scheme: dark) { .callout{ background:#0f172a; } }
    ul { padding-left: 1.2rem; }
    li { margin: 0.45rem 0; }
    .footer { margin-top: 2rem; font-size: 0.9rem; color: var(--muted); }
  </style>
</head>
<body>
  <div class="container">
    <header class="hero">
      <h1>Stop Wasting Tokens: CCAD boosts unique generation by +18 points (54%→72%)</h1>
      <p class="lead">How <strong>Cumulative Context Anti‑Duplication (CCAD)</strong> reduces duplicate generation with canonicalization, cumulative anti‑dup context, exact + <em>fuzzy</em> dedup (ECFP4/Tanimoto), deterministic RAG, and adaptive policy.</p>
      <div class="meta">EurekaMesh Labs • v0.1.0 • Updated: Dec 21, 2025 • <a href="https://github.com/EurekaMesh-Labs/eurekamesh" target="_blank" rel="noopener">Repository</a> • <a href="https://github.com/EurekaMesh-Labs/eurekamesh/releases/tag/v0.1.0" target="_blank" rel="noopener">Release</a></div>
      <div class="tags">
        <span class="tag">LLM</span><span class="tag">Drug Discovery</span><span class="tag">RAG</span><span class="tag">Cheminformatics</span>
      </div>
      <figure style="margin-top:1rem;">
        <img alt="UPT and duplicate rate per mode" src="https://raw.githubusercontent.com/EurekaMesh-Labs/eurekamesh/main/figures/abtest_upt_dup.svg" />
        <figcaption>Headline result: UPT improvement with CCAD across modes (none/basic/rag).</figcaption>
      </figure>
    </header>

    <section>
      <h2>TL;DR</h2>
      <ul>
        <li><strong>Efficiency</strong>: CCAD increases UPT by <strong>≈15–18% absolute</strong> (e.g., 54.0% ± 8.7% → ~70–72%).</li>
        <li><strong>Translation</strong>: +18 points absolute ≈ <strong>~33% relative</strong> efficiency gain (72/54 ≈ 1.33).</li>
        <li><strong>How</strong>: SMILES canonicalization, cumulative <em>anti‑dup context</em>, exact dedup, <strong>fuzzy</strong> ECFP4/Tanimoto with <code>reject | count | allow</code>, plus deterministic RAG.</li>
        <li><strong>Quality</strong>: 100% Lipinski; SA‑Score ≈3.3 for molecules; 100% UPT in sequences.</li>
        <li><strong>3‑command quickstart</strong>: install, simulate via <code>MOCK_LLM</code>, produce an HTML report.</li>
      </ul>
      <div class="callout">
        Reference whitepaper (technical details, results, and citations): 
        <a href="https://github.com/EurekaMesh-Labs/eurekamesh/blob/main/docs/CCAD_PAPER_DRAFT.md" target="_blank" rel="noopener">CCAD_PAPER_DRAFT.md</a>
        (<a href="https://raw.githubusercontent.com/EurekaMesh-Labs/eurekamesh/main/docs/CCAD_PAPER_DRAFT.md" target="_blank" rel="noopener">raw</a>).
      </div>
      <p style="margin-top:.75rem;"><strong>Hook</strong>: Duplicate outputs = wasted tokens. CCAD turns duplication into a controllable signal.</p>
    </section>

    <section>
      <h2>Mini example (why duplicates hurt)</h2>
      <pre><code># Prompt (simplified)
Generate 10 drug-like SMILES. One per line. No numbering.

# Raw LLM output (example)
CCO
CCN
OCC     # duplicate of CCO (notation)
CCO     # exact duplicate
c1ccccc1
CCN     # exact duplicate
CC(=O)O
CCOC
CCBr
CCCl

# Naive baseline → 10 generated, 6 unique → UPT 60%
# CCAD (canon + context + exact/fuzzy) → avoids repeats → UPT ~72%</code></pre>
      <p><strong>Baseline (clarified)</strong>: prompt with <em>no</em> canonicalization, <em>no</em> anti‑dup context, and <em>no</em> real‑time filters/dedup.</p>
    </section>

    <section>
      <h2>What is UPT?</h2>
      <p><strong>Unique‑per‑Token (UPT)</strong> is the fraction of generated items that are unique at the canonical level: <code>UPT = unique_accepted / total_generated</code>. We also report <code>UPT_valid</code> when considering only valid items in the denominator.</p>
    </section>

    <section>
      <h2>Why duplicates matter</h2>
      <p>In dense combinatorial spaces (e.g., molecules), LLMs often repeat structures or notational variants. Every duplicate is <em>wasted tokens and cost</em>, reduces coverage, and slows exploration.</p>
    </section>

    <section>
      <h2>What CCAD is</h2>
      <ul>
        <li><strong>Canonicalization</strong>: standardizes items (e.g., SMILES via RDKit) to detect equivalences “CCO” ≡ “OCC”.</li>
        <li><strong>Cumulative anti‑dup context</strong>: injects the latest <em>K</em> items from <code>canonical_history</code> to steer the LLM away from repetition.</li>
        <li><strong>Exact dedup</strong>: real‑time filtering on canonical form (O(1) set lookup).</li>
        <li><strong>Fuzzy chemical dedup (optional)</strong>: ECFP4/Tanimoto with <code>reject | count | allow</code> and typical threshold 0.90–0.95.</li>
        <li><strong>Deterministic RAG (optional)</strong>: context compression with prototypes (Sentence‑BERT) and a deterministic embedding fallback (BLAKE2b + <code>np.random.default_rng</code>).</li>
        <li><strong>Adaptive policy</strong>: adjusts <em>context size</em>, <code>fuzzy_threshold</code>, and <code>temperature</code> based on <code>dup_rate</code> and <code>valid_rate</code>.</li>
      </ul>
      <p><strong>A/B/C modes</strong>: <code>none</code> (no context; still with canonicalization + dedup), <code>basic</code> (last K items), <code>rag</code> (prototypes). “none” is <em>not</em> the naive baseline; the naive baseline is outside CCAD.</p>
    </section>

    <section>
      <h2>Results (summary)</h2>
      <div class="grid grid-2">
        <figure>
          <img alt="UPT and duplicate rate per mode" src="https://raw.githubusercontent.com/EurekaMesh-Labs/eurekamesh/main/figures/abtest_upt_dup.svg" />
          <figcaption>UPT and duplicate rate per mode (none/basic/rag).</figcaption>
        </figure>
        <figure>
          <img alt="UPT per run" src="https://raw.githubusercontent.com/EurekaMesh-Labs/eurekamesh/main/figures/abtest_runs_upt.svg" />
          <figcaption>UPT trend per run and condition.</figcaption>
        </figure>
      </div>
      <figure>
        <img alt="Post-filters summary" src="https://raw.githubusercontent.com/EurekaMesh-Labs/eurekamesh/main/figures/post_filters_summary.svg" />
        <figcaption>Quality after filters: Lipinski and SA‑Score.</figcaption>
      </figure>
      <ul>
        <li><strong>Molecules (EGFR)</strong>: UPT ≈ 71.6–72.0%, Lipinski 100%, SA ≈ 3.36–3.54.</li>
        <li><strong>Sequences (enzymes)</strong>: UPT = 100% (sparse space), no degradation.</li>
        <li><strong>RAG</strong>: +0.4% UPT and 3–5× context compression (benefit grows with N).</li>
      </ul>
    </section>

    <section>
      <h2>Quickstart (3 commands, offline)</h2>
      <pre><code>pip install -e .
export MOCK_LLM=$'CCO\nCCN\nC1=CC=CC=C1\nCC(=O)O\nCCO'
make e2e   # tests + baseline + A/B/C + figures + HTML report</code></pre>
      <p>Open <code>report/index.html</code> to inspect metrics and figures. For <em>live</em> mode, set <code>OPENAI_API_KEY</code> and run <code>make abtest</code> / <code>make report</code>.</p>
    </section>

    <section>
      <h2>Reproducibility and observability</h2>
      <ul>
        <li><strong>Determinism</strong>: deterministic embedding fallback; seeds and configs via environment.</li>
        <li><strong>Structured logs</strong>: JSONL + CSV (UPT_raw/valid, dup_rate_raw/valid, tokens/cost).</li>
        <li><strong>Reports</strong>: figures (PNG/SVG) and HTML; Streamlit dashboard (<code>make dashboard</code>).</li>
        <li><strong>CI</strong>: tests and report with <code>MOCK_LLM</code> on GitHub Actions.</li>
      </ul>
    </section>

    <section>
      <h2>Roadmap (next)</h2>
      <ul>
        <li>GuacaMol/MOSES integration (FCD, SNN, IntDiv) as an optional step in <code>make report</code>.</li>
        <li>LLM connector hardening (retries, timeouts, rate limiting, caching).</li>
        <li>Accelerated <em>fuzzy</em> (batched/GPU) and FAISS for learned embeddings.</li>
        <li>Run registry (JSONL v1 schema) + dashboard browser.</li>
      </ul>
      <p>See open issues: <a href="https://github.com/EurekaMesh-Labs/eurekamesh/issues" target="_blank" rel="noopener">EurekaMesh-Labs/eurekamesh • Issues</a>.</p>
    </section>

    <section>
      <h2>Get started</h2>
      <ul>
        <li>Repository: <a href="https://github.com/EurekaMesh-Labs/eurekamesh" target="_blank" rel="noopener">github.com/EurekaMesh-Labs/eurekamesh</a></li>
        <li>Whitepaper: <a href="https://github.com/EurekaMesh-Labs/eurekamesh/blob/main/docs/CCAD_PAPER_DRAFT.md" target="_blank" rel="noopener">CCAD_PAPER_DRAFT.md</a></li>
        <li>Release v0.1.0: <a href="https://github.com/EurekaMesh-Labs/eurekamesh/releases/tag/v0.1.0" target="_blank" rel="noopener">release notes</a></li>
      </ul>
    </section>

    <footer class="footer">
      © EurekaMesh Labs — CCAD is open‑source software (MIT). If you use it in research, please cite: 
      <a href="https://raw.githubusercontent.com/EurekaMesh-Labs/eurekamesh/main/docs/CCAD_PAPER_DRAFT.md" target="_blank" rel="noopener">CCAD_PAPER_DRAFT.md</a>.
      <br />Want to build a domain adapter? <strong><a href="https://github.com/EurekaMesh-Labs/eurekamesh/issues/new" target="_blank" rel="noopener">Open an issue with your domain and a sample output</a></strong>.
    </footer>
  </div>
</body>
</html>


